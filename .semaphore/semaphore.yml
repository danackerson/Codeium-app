version: v1.0
name: MyPipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004

blocks:
  - name: "Build and Test Node.js Application"
    task:
      jobs:
        - name: "Install, Start and Test Node App"
          commands:
            - checkout
            - echo "Installing dependencies..."
            - npm install
            - echo "Starting the Node.js application..."
            - node app.js >app.log 2>&1 &
            - echo "Waiting for the application to start..."         
            - echo "Testing if the application is up and running..."
            - curl localhost:3000
